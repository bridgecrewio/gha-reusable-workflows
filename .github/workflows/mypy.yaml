name: mypy

on:
  workflow_call:
    inputs:
      cache-dependency-path:
        description: "Path to the Pipfile.lock"
        default: "Pipfile.lock"
        required: false
        type: string
      python-version:
        description: "Python version to be used"
        default: "3.7"
        required: false
        type: string
      runner:
        description: "GitHub runner label"
        default: "ubuntu-latest"
        required: false
        type: string

permissions:
  contents: read

jobs:
  mypy:
    runs-on: ${{ inputs.runner }}
    env:
      MYPY_CACHE_DIR: ~/.cache/mypy
    steps:
      - uses: actions/checkout@8e5e7e5ab8b370d6c329ec480221332ada57f0ab  # v3.5.2
      - uses: actions/setup-python@bd6b4b6205c4dbad673328db7b31b7fab9e241c0  # v4.6.1
        id: setup-python
        with:
          python-version: ${{ inputs.python-version }}
          cache: "pipenv"
          cache-dependency-path: ${{ inputs.cache-dependency-path }}
      - name: Install pipenv
        run: |
          python -m pip install --no-cache-dir --upgrade pipenv
      - name: Install dependencies
        run: |
          pipenv --python ${{ inputs.python-version }}
          pipenv install --dev
      - uses: actions/cache@88522ab9f39a2ea568f7027eddc7d8d8bc9d59c8  # v3
        with:
          path: ${{ env.MYPY_CACHE_DIR }}
          key: mypy-${{ runner.os }}-python-${{ steps.setup-python.outputs.python-version }}-${{ hashFiles(inputs.cache-dependency-path) }}
      - name: Run Mypy
        run: |
          pipenv run mypy
